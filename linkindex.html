<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Apertura</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom, #e0e0e0, #cfcfcf);
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
    height: 100vh;
  }

  .cuadro {
    background: white;
    padding: 3rem;
    border-radius: 15px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.25);
    text-align: center;
    width: 98%;
    max-width: 750px;
  }

  h2 {
    font-size: 4rem;
    margin-bottom: 1rem;
    white-space: nowrap;
  }

  #apartamento {
    font-size: 3.6rem;
    font-weight: bold;
    margin-bottom: 2rem;
  }

  .fecha-hora {
    font-size: 2.8rem;
    margin-bottom: 2rem;
  }

  .botones {
    display: flex;
    justify-content: center;
    gap: 2cm;
    margin-top: 2cm;
  }

  button {
    width: 280px;
    padding: 2.5rem 1rem;
    font-size: 2.8rem;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.15s ease;
    transform: translateY(0);
  }

  /* BOTÓN VERDE 3D */
  #abrir {
    background: linear-gradient(to bottom, #34d058, #28a745);
    color: white;
    box-shadow:
      0 8px 0 #1e7e34,
      0 12px 20px rgba(0,0,0,0.3);
  }

  /* BOTÓN ROJO 3D */
  #apagar {
    background: linear-gradient(to bottom, #ff5f5f, #dc3545);
    color: white;
    box-shadow:
      0 8px 0 #a71d2a,
      0 12px 20px rgba(0,0,0,0.3);
  }

  /* EFECTO AL PULSAR (SE HUNDE) */
  button:active {
    transform: translateY(6px);
    box-shadow:
      0 2px 0 rgba(0,0,0,0.4),
      0 6px 12px rgba(0,0,0,0.3);
  }

  button:disabled {
    background: #aaa !important;
    color: #666 !important;
    box-shadow: none;
    cursor: not-allowed;
  }

  #mensaje {
    font-size: 2.6rem;
    color: red;
    margin-top: 1rem;
  }

  @media (max-width: 700px) {
    .cuadro { width: 95%; }
    button {
      width: 45%;
      font-size: 2.2rem;
      padding: 2rem 0.5rem;
    }
    h2 { font-size: 3rem; }
    #apartamento { font-size: 2.5rem; }
    .fecha-hora { font-size: 2rem; }
  }
</style>
</head>
<body>

<div class="cuadro">
  <h2>Control de Apertura</h2>
  <p id="apartamento"></p>

  <div class="fecha-hora">
    Inicio: <span id="fechaInicio"></span> <span id="horaInicio"></span>
  </div>

  <div class="fecha-hora">
    Fin: <span id="fechaFin"></span> <span id="horaFin"></span>
  </div>
  
  <div class="botones">
    <button id="abrir">Abrir</button>
    <button id="apagar">Cerrar</button>
  </div>

  <p id="mensaje"></p>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const f1 = params.get('f1'); 
  const h1 = params.get('h1'); 
  const f2 = params.get('f2'); 
  const h2 = params.get('h2'); 
  const a  = Math.min(Math.max(parseInt(params.get('a')),1),10) || 1;

  const luces = {
    1: {encender: 'http://192.168.1.51/encender', apagar: 'http://192.168.1.51/apagar'},
    2: {encender: 'http://192.168.1.52/encender', apagar: 'http://192.168.1.52/apagar'},
    3: {encender: 'http://192.168.1.53/encender', apagar: 'http://192.168.1.53/apagar'},
    4: {encender: 'http://192.168.1.54/encender', apagar: 'http://192.168.1.54/apagar'},
    5: {encender: 'http://192.168.1.55/encender', apagar: 'http://192.168.1.55/apagar'},
    6: {encender: 'http://192.168.1.56/encender', apagar: 'http://192.168.1.56/apagar'},
    7: {encender: 'http://192.168.1.57/encender', apagar: 'http://192.168.1.57/apagar'},
    8: {encender: 'http://192.168.1.58/encender', apagar: 'http://192.168.1.58/apagar'},
    9: {encender: 'http://192.168.1.59/encender', apagar: 'http://192.168.1.59/apagar'},
    10:{encender: 'http://192.168.1.60/encender', apagar: 'http://192.168.1.60/apagar'}
  };

  function formatearFechaHora(f, h){
    return { 
      fecha: f.slice(0,4)+'-'+f.slice(4,6)+'-'+f.slice(6,8),
      hora: h.slice(0,2)+':'+h.slice(2,4)
    };
  }

  const inicio = formatearFechaHora(f1,h1);
  const fin = formatearFechaHora(f2,h2);

  document.getElementById('apartamento').textContent = `Apartamento ${a}`;
  document.getElementById('fechaInicio').textContent = inicio.fecha;
  document.getElementById('horaInicio').textContent = inicio.hora;
  document.getElementById('fechaFin').textContent = fin.fecha;
  document.getElementById('horaFin').textContent = fin.hora;

  const btnAbrir = document.getElementById('abrir');
  const btnApagar = document.getElementById('apagar');
  const mensaje = document.getElementById('mensaje');

  function validarAcceso(){
    const ahora = new Date();
    const fIni = new Date(`${inicio.fecha}T${inicio.hora}:00`);
    const fFin = new Date(`${fin.fecha}T${fin.hora}:00`);

    if(ahora >= fIni && ahora <= fFin){
      btnAbrir.disabled = false;
      btnApagar.disabled = false;
      mensaje.textContent = '';
    } else {
      btnAbrir.disabled = true;
      btnApagar.disabled = true;
      mensaje.textContent = 'Fuera de fechas u horario';
    }
  }

  validarAcceso();
  setInterval(validarAcceso, 60000);

  btnAbrir.onclick = () => {
    fetch(luces[a].encender).catch(()=>alert('No se pudo enviar señal'));
  };

  btnApagar.onclick = () => {
    fetch(luces[a].apagar).catch(()=>alert('No se pudo enviar señal'));
  };
</script>

</body>
</html>
